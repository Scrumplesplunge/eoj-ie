(()=>{"use strict";var t={913:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.simulationSpeed=e.debug=void 0,e.debug=!1,e.simulationSpeed=1,addEventListener("keydown",(t=>{switch(t.code){case"Comma":e.simulationSpeed>1&&(e.simulationSpeed>>=1);break;case"Period":e.simulationSpeed<16&&(e.simulationSpeed<<=1);break;case"Slash":e.debug=!e.debug}}))},601:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SENSOR_TIME=e.DELTA_TIME=e.PLANET_DAY=e.TRANSMISSION_SPEED=e.ATMOSPHERE_SIZE=e.PLANET_RADIUS=e.GRAVITY=e.MAX_ROCKET_THRUSTER_ANGLE=e.RCS_THRUST=e.ROCKET_THRUST=e.RCS_FUEL=e.FUEL=e.ROCKET_MASS=e.ROCKET_HEIGHT=e.ROCKET_WIDTH=void 0,e.ROCKET_WIDTH=10,e.ROCKET_HEIGHT=50,e.ROCKET_MASS=2e3*Math.PI*Math.pow(e.ROCKET_WIDTH,2)*e.ROCKET_HEIGHT/4,e.FUEL=1e7,e.RCS_FUEL=1e4,e.ROCKET_THRUST=2e9,e.RCS_THRUST=2e6,e.MAX_ROCKET_THRUSTER_ANGLE=1,e.GRAVITY=12e4*Math.pow(1e3,2)/(2*Math.PI),e.PLANET_RADIUS=15e3,e.ATMOSPHERE_SIZE=4e3,e.TRANSMISSION_SPEED=3e4,e.PLANET_DAY=3600,e.DELTA_TIME=1/128,e.SENSOR_TIME=1/16},279:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.draw=e.camera=void 0;const i=o(490),n=document.querySelector("#display"),s=n.getContext("2d");function r(){n.width=innerWidth,n.height=innerHeight}e.camera={position:new i.Vector(0,0),angle:0,zoom:.01},r(),addEventListener("resize",r),addEventListener("wheel",(t=>{e.camera.zoom*=Math.exp(.002*-t.deltaY)})),e.draw=function(t){const{width:o,height:i}=n;s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,o,i),s.translate(.5*o,.5*i);const r=.5*e.camera.zoom*Math.min(o,i);s.scale(r,r),s.rotate(-e.camera.angle),s.translate(-e.camera.position.x,-e.camera.position.y),t(s)}},490:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.angnorm=e.Matrix=e.Vector=void 0;class o{constructor(t,e){this.x=t,this.y=e}static random(){const t=Math.sqrt(-2*Math.log(1-Math.random())),e=2*Math.PI*Math.random();return new o(t*Math.cos(e),t*Math.sin(e))}static fromAngle(t){return new o(Math.cos(t),Math.sin(t))}neg(){return new o(-this.x,-this.y)}add(t){return new o(this.x+t.x,this.y+t.y)}sub(t){return new o(this.x-t.x,this.y-t.y)}mul(t){return new o(this.x*t,this.y*t)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}len(){return Math.sqrt(this.dot(this))}rot90(){return new o(-this.y,this.x)}norm(){return this.mul(1/this.len())}}e.Vector=o;class i{constructor(t,e){this.a=t,this.b=e}static rotate(t){const e=Math.cos(t),n=Math.sin(t);return new i(new o(e,n),new o(-n,e))}static fromRows(t,e){return new i(new o(t.x,e.x),new o(t.y,e.y))}apply(t){return this.a.mul(t.x).add(this.b.mul(t.y))}determinant(){return this.a.cross(this.b)}inverse(){const t=this.determinant();if(0==t)throw new Error("Inverting a non-invertible matrix");const e=1/t;return new i(new o(e*this.b.y,e*-this.a.y),new o(e*-this.b.x,e*this.a.x))}}e.Matrix=i;const n=Math.PI,s=2*n;e.angnorm=function(t){return((t+n)%s+s)%s-n}},357:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.separate=e.collide=e.PhysicsObject=e.ConvexPolygon=void 0;const i=o(490);class n{constructor(t){this.vertices=t}static regular(t,e){const o=[],s=2*Math.PI/t;for(let n=0;n<t;n++){const t=n*s;o.push(new i.Vector(e*Math.cos(t),e*Math.sin(t)))}return new n(o)}at(t,e){const o=i.Matrix.rotate(e);return new n(this.vertices.map((e=>o.apply(e).add(t))))}area(){const t=this.vertices,e=t.length;let o=t[e-1].cross(t[0]);for(let i=1;i<e;i++)o+=t[i-1].cross(t[i]);return.5*o}support(t){const e=this.vertices;let o=e[0].dot(t),i=e[0];const n=e.length;for(let s=1;s<n;s++){const n=e[s].dot(t);n>o&&(o=n,i=e[s])}return i}leastPenetration(t){let e=null,o=this.vertices[this.vertices.length-1];for(const i of this.vertices){const n=i.sub(o).rot90().norm(),s=t.support(n),r=s.dot(n)-i.dot(n);if(r<0)return null;(null==e||r<e.distance)&&(e={distance:r,contact:s,normal:n.neg()}),o=i}return e}intersect(t){const e=this.leastPenetration(t);if(!e)return null;const o=t.leastPenetration(this);return o?e.distance<o.distance?{contact:e.contact.add(e.normal.mul(e.distance)),normal:e.normal,distance:e.distance}:{contact:o.contact,normal:o.normal.neg(),distance:o.distance}:null}path(t){const e=this.vertices[this.vertices.length-1];t.moveTo(e.x,e.y);for(const e of this.vertices)t.lineTo(e.x,e.y)}draw(t){t.beginPath(),this.path(t);const e=t.getTransform();t.strokeStyle="#fff",t.setTransform(1,0,0,1,0,0),t.stroke(),t.setTransform(e)}}e.ConvexPolygon=n,e.PhysicsObject=class{constructor(t){this.mesh=t,this.position=new i.Vector(0,0),this.velocity=new i.Vector(0,0),this.angle=0,this.angularVelocity=0,this.inverseMass=1,this.inverseInertia=1}worldMesh(){return this.mesh.at(this.position,this.angle)}update(t){this.position=this.position.add(this.velocity.mul(t)),this.angle=(0,i.angnorm)(this.angle+this.angularVelocity*t)}applyImpulse(t,e){this.velocity=this.velocity.add(t.mul(this.inverseMass));const o=e.sub(this.position);this.angularVelocity+=o.cross(t)*this.inverseInertia}velocityAt(t){const e=t.sub(this.position);return this.velocity.add(e.rot90().mul(this.angularVelocity))}toLocal(t){return i.Matrix.rotate(-this.angle).apply(t.sub(this.position))}toWorld(t){return i.Matrix.rotate(this.angle).apply(t).add(this.position)}},e.collide=function(t,e,o,i,n){const s=e.velocityAt(o).sub(t.velocityAt(o)),r=i.dot(s);if(r>0)return;const a=Math.pow(o.sub(t.position).cross(i),2)*t.inverseInertia,l=Math.pow(o.sub(e.position).cross(i),2)*e.inverseInertia,c=1/(t.inverseMass+e.inverseMass+a+l),h=-(1+n.restitution)*r*c;t.applyImpulse(i.mul(-h),o),e.applyImpulse(i.mul(h),o);const u=i.rot90(),p=Math.pow(o.sub(t.position).cross(u),2)*t.inverseInertia,d=Math.pow(o.sub(e.position).cross(u),2)*e.inverseInertia,m=1/(t.inverseMass+e.inverseMass+p+d),f=-s.dot(u)*m,g=Math.abs(f)<h*n.staticFriction?f:Math.sign(f)*h*n.dynamicFriction;t.applyImpulse(u.mul(-g),o),e.applyImpulse(u.mul(g),o)},e.separate=function(t,e,o,i){const n=Math.max(i-.01,0)/(t.inverseMass+e.inverseMass),s=o.mul(.8*n);t.position=t.position.sub(s.mul(t.inverseMass)),e.position=e.position.add(s.mul(e.inverseMass))}},477:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.planet=e.Planet=void 0;const i=o(357),n=o(279),s=o(601),r=new Image;r.src="grass.png";const a=.001;class l extends i.PhysicsObject{constructor(){super(l.MESH),this.inverseMass=0,this.inverseInertia=0,this.angularVelocity=2*Math.PI/s.PLANET_DAY}draw(t){t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.angle);const e=s.PLANET_RADIUS+s.ATMOSPHERE_SIZE,o=t.createRadialGradient(0,0,s.PLANET_RADIUS,0,0,e);if(o.addColorStop(0,"#00ffff"),o.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=o,t.fillRect(-e,-e,2*e,2*e),t.beginPath(),this.mesh.path(t),t.fillStyle="#208215",t.fill(),n.camera.zoom>a){const e=Math.log(n.camera.zoom)-Math.log(a),o=Math.log(.005)-Math.log(a),i=Math.min(e/o,1);t.globalAlpha=i,t.fillStyle=t.createPattern(r,"repeat"),t.fill(),t.globalAlpha=1}t.translate(s.PLANET_RADIUS,0),t.rotate(Math.PI/2),t.fillStyle="#666",t.beginPath(),t.moveTo(-20,0),t.lineTo(-20,1),t.lineTo(-16,5),t.lineTo(16,5),t.lineTo(20,1),t.lineTo(20,0),t.fill(),t.restore()}}e.Planet=l,l.MESH=i.ConvexPolygon.regular(1024,s.PLANET_RADIUS),e.planet=new l,e.default=e.planet},374:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.drawStatus=e.check=void 0;const i=o(601),n=o(490),s=o(477),r=o(842),a=o(536);function l(){return n.Vector.fromAngle(s.planet.angle).mul(i.PLANET_RADIUS+.53*i.ROCKET_HEIGHT)}function c(){return r.rocket.position.sub(s.planet.position).len()-i.PLANET_RADIUS}const h=[{description:"Take off",test:function(){const t=(0,n.angnorm)(r.rocket.angle-s.planet.angle),e=r.rocket.velocity.sub(s.planet.velocityAt(r.rocket.position)),o=(0,n.angnorm)(Math.atan2(e.y,e.x)-s.planet.angle);return c()>100&&Math.abs(t)<.5&&Math.abs(o)<.5}},{description:"Leave the atmosphere",test:function(){return c()>i.ATMOSPHERE_SIZE}},{description:"Pass the opposite pole",test:function(){const t=Math.atan2(r.rocket.position.y,r.rocket.position.x),e=s.planet.angle+Math.PI;return Math.abs((0,n.angnorm)(t-e))<.1}},{description:"Fly the rocket home",test:function(){return l().sub(r.rocket.position).len()<500}},{description:"Land on the launchpad",test:function(){r.rocket.position.sub(s.planet.position);const t=(0,n.angnorm)(r.rocket.angle-s.planet.angle),e=l().sub(r.rocket.position),o=r.rocket.velocity.sub(s.planet.velocityAt(r.rocket.position)),i=r.rocket.angularVelocity-s.planet.angularVelocity;return 1==r.rocket.landingGear&&e.len()<15&&Math.abs(t)<.1&&o.len()<1&&Math.abs(i)<.1}}];let u=0;e.check=function(){for(;u<h.length&&h[u].test();)u++},e.drawStatus=function(t){var e;const o=t.getTransform();t.setTransform(1,0,0,1,0,0),t.font="20pt sans-serif",t.textBaseline="top",t.textAlign="left",t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,300,20+30*h.length);for(let e=0,o=h.length;e<o;e++){const o=10+30*e;t.fillStyle=e<u?"#0f0":e==u?"#ff0":"#888",t.fillText(h[e].description,10,o)}const n=[`difficulty: ${null!==(e=a.difficulty)&&void 0!==e?e:"not set"}`,"flight time: "+(s=r.rocket.flightTime,`${Math.floor(s/60)}:${(s%60).toFixed(2).padStart(5,"0")}`),`mass: ${Math.ceil(r.rocket.mass())}kg`,`fuel: ${Math.ceil(100*r.rocket.fuel/i.FUEL)}%`,`RCS fuel: ${Math.ceil(100*r.rocket.rcsFuel/i.RCS_FUEL)}%`];var s;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(t.canvas.width-300,0,300,20+30*n.length),t.fillStyle="#fff",t.textAlign="right",t.textBaseline="top";let l=10;for(const e of n)t.fillText(e,t.canvas.width-10,l),l+=30;t.setTransform(o)}},842:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.rocket=e.Rocket=void 0;const i=o(601),n=o(913),s=o(490),r=o(357),a=o(477),l=o(211),c=o(536),h=1/12*(3/4*Math.pow(i.ROCKET_WIDTH,2)+Math.pow(i.ROCKET_HEIGHT,2)),u=.7,p=.4*i.ROCKET_WIDTH,d={easy:5.4,medium:2.7,hard:.9},m={easy:100,medium:10,hard:3},f={easy:100,medium:25,hard:5},g={easy:8,medium:4,hard:2},T={easy:0,medium:0,hard:25e4},y={easy:0,medium:0,hard:500};function E(t){var e;return t[null!==(e=c.difficulty)&&void 0!==e?e:"hard"]}const M=.5,v={topLeft:{thrustDirection:new s.Vector(0,1),position:new s.Vector(.5*i.ROCKET_HEIGHT*M,-.5*i.ROCKET_WIDTH)},topRight:{thrustDirection:new s.Vector(0,-1),position:new s.Vector(.5*i.ROCKET_HEIGHT*M,.5*i.ROCKET_WIDTH)},bottomLeft:{thrustDirection:new s.Vector(0,1),position:new s.Vector(-.5*i.ROCKET_HEIGHT*M,-.5*i.ROCKET_WIDTH)},bottomRight:{thrustDirection:new s.Vector(0,-1),position:new s.Vector(-.5*i.ROCKET_HEIGHT*M,.5*i.ROCKET_WIDTH)}};class b extends r.PhysicsObject{constructor(){super(b.MESH),this.intent={landingGearDown:!0,thrusterAngle:0,thrust:0,topFlapAngle:0,bottomFlapAngle:0,rcsThrust:{topLeft:0,topRight:0,bottomLeft:0,bottomRight:0}},this.landingGear=1,this.thrusterAngle=0,this.thrust=0,this.topFlapAngle=0,this.bottomFlapAngle=0,this.acceleration=new s.Vector(0,0),this.previousVelocity=new s.Vector(0,0),this.fuel=i.FUEL,this.rcsFuel=i.RCS_FUEL,this.exploded=!1,this.flightTime=0,this.inverseMass=1/this.mass(),this.inverseInertia=this.inverseMass/h,this.legContacts=b.LEG_JOINTS.map((t=>null)),this.dragSides=[]}mass(){return i.ROCKET_MASS+this.fuel+this.rcsFuel}applyImpulse(t,e){const o=this.velocityAt(e);super.applyImpulse(t,e);const i=this.velocityAt(e);if(i.sub(o).len()>20){for(let t=0;t<256;t++)l.addExplosion(e,i.add(i.sub(o).add(s.Vector.random().mul(50)).mul(2)),75);this.exploded=!0,this.fuel=0,this.rcsFuel=0}}update(t){if(this.acceleration=this.velocity.sub(this.previousVelocity).mul(1/t),this.previousVelocity=this.velocity,this.inverseMass=1/this.mass(),this.inverseInertia=this.inverseMass/h,super.update(t),!this.exploded){{const e=this.intent.landingGearDown?1:0,o=this.landingGear,i=E(d),n=Math.min(Math.max(e-o,-t*i),t*i);this.landingGear+=n}{const e=this.intent.thrusterAngle,o=this.thrusterAngle,i=E(m),n=Math.min(Math.max(e-o,-t*i),t*i);this.thrusterAngle+=n}{const e=this.intent.thrust,o=this.thrust,n=E(f),r=Math.min(Math.max(e-o,-t*n),t*n);this.thrust+=r,this.fuel-=this.thrust*E(T)*t,this.fuel<0&&(this.fuel=0,this.thrust=0);const a=s.Vector.fromAngle(this.angle+this.thrusterAngle),c=this.toWorld(new s.Vector(1.25-.6*i.ROCKET_HEIGHT*.8,0));this.applyImpulse(a.mul(i.ROCKET_THRUST*this.thrust*t),c);const h=Math.floor(10*this.thrust+Math.random()),u=c.sub(a.mul(7.5));for(let t=0;t<h;t++){const t=u.add(s.Vector.random().mul(.5)),e=a.add(s.Vector.random().mul(.1));l.addSmoke(t,this.velocityAt(t).add(e.mul(-500)),25)}}{const e=this.intent.topFlapAngle,o=this.topFlapAngle,i=E(g),n=Math.min(Math.max(e-o,-t*i),t*i);this.topFlapAngle+=n}{const e=this.intent.bottomFlapAngle,o=this.bottomFlapAngle,i=E(g),n=Math.min(Math.max(e-o,-t*i),t*i);this.bottomFlapAngle+=n}for(const[e,o]of Object.entries(this.rcs())){let n=this.intent.rcsThrust[e];this.rcsFuel-=n*E(y)*t,this.rcsFuel<0&&(this.rcsFuel=0,n=0),this.applyImpulse(o.thrustDirection.mul(i.RCS_THRUST*n),o.position);const r=Math.floor(10*n+Math.random()),a=o.position.sub(o.thrustDirection.mul(1));for(let t=0;t<r;t++){const t=a.add(s.Vector.random().mul(.1)),e=o.thrustDirection.add(s.Vector.random().mul(.1));l.addSmoke(t,this.velocityAt(t).add(e.mul(-100)),5)}}}{const e=[];e.push({mesh:this.worldMesh(),size:.5*i.ROCKET_WIDTH});for(const t of this.legs())e.push({mesh:t,size:.05});const o=this.flaps();e.push({mesh:o[0],size:2*p*(1-Math.abs(this.topFlapAngle))}),e.push({mesh:o[1],size:2*p*(1-Math.abs(this.bottomFlapAngle))}),this.dragSides=[];for(const{mesh:o,size:i}of e){const e=o.vertices,n=e.length;for(let o=0;o<n;o++)this.applyAirResistance(e[o?o-1:n-1],e[o],i,t)}}const e=this.legs().map((t=>a.planet.mesh.intersect(t)));this.legContacts=e.map((t=>null==t?void 0:t.contact)),!this.exploded&&e.every((t=>!t))&&(this.flightTime+=t);const o=[];for(const i of e){if(!i)continue;const{contact:e,distance:n,normal:s}=i;if(n<.1)continue;const r=this.velocityAt(e).sub(a.planet.velocityAt(e)),l=r.dot(s),c=s.mul(l),h=r.sub(c),u=this.mass();if(o.push({impulse:h.mul(-.1*u),contact:e}),l>5*(1-n/10))continue;const p=(n/10*100-.5*l)*u,d=75*u,m=Math.min(t*d,p),f=s.mul(m);o.push({impulse:f,contact:e})}for(const{impulse:t,contact:e}of o)this.applyImpulse(t,e)}applyAirResistance(t,e,o,n){const s=e.sub(t),r=t.add(s.mul(.5)),l=a.planet.velocityAt(r),c=this.velocityAt(r).sub(l),h=s.cross(c);if(h>0)return;const u=Math.max(0,r.sub(a.planet.position).len()-i.PLANET_RADIUS),p=250*Math.max(1-u/i.ATMOSPHERE_SIZE,0),d=s.rot90().mul(p*Math.pow(h,2)*o*n/s.dot(s));this.applyImpulse(d,r),this.dragSides.push({a:t,b:e,impulse:d})}legs(){const t=s.Matrix.rotate(this.angle);return b.LEG_JOINTS.map((e=>b.LEG_MESH.at(this.position.add(t.apply(e.position)),this.angle+e.angle*this.landingGear)))}flaps(){const t=s.Matrix.rotate(this.angle);return[new s.Vector(.2*i.ROCKET_HEIGHT,.5*p*this.topFlapAngle),new s.Vector(-.2*i.ROCKET_HEIGHT,.5*p*this.bottomFlapAngle)].map((e=>b.FLAP_MESH.at(this.position.add(t.apply(e)),this.angle)))}rcs(){const t=s.Matrix.rotate(this.angle),e=e=>({position:this.position.add(t.apply(e.position)),thrustDirection:t.apply(e.thrustDirection)});return{topLeft:e(v.topLeft),topRight:e(v.topRight),bottomLeft:e(v.bottomLeft),bottomRight:e(v.bottomRight)}}draw(t){t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.angle),t.beginPath(),t.lineCap="round",t.lineJoin="round";const e=s.Matrix.rotate(-this.angle),o=t=>e.apply(t.sub(this.position));for(let e=0;e<2;e++){const i=b.LEG_JOINTS[e];t.moveTo(i.position.x,i.position.y);const n=this.legContacts[e],r=n?o(n):i.position.add(s.Vector.fromAngle(this.landingGear*i.angle).mul(10));t.lineTo(r.x,r.y)}t.strokeStyle="#555",t.stroke(),t.beginPath();const a=.5*i.ROCKET_WIDTH,l=.5*i.ROCKET_HEIGHT;t.moveTo(-.84*l,-a),t.lineTo(-.96*l,0),t.lineTo(-.84*l,a),t.lineTo(.4*l,a),t.bezierCurveTo(.8*.75*l,a,.8*l,.25*a,.8*l,0),t.bezierCurveTo(.8*l,-.25*a,.8*.75*l,-a,.4*l,-a),t.fillStyle=this.exploded?"#333":"#bbb",t.fill(),t.save(),t.translate(-1.2*l*.8,0),t.rotate(this.thrusterAngle),t.translate(1.25,0),t.beginPath(),t.moveTo(-5,-2.5),t.bezierCurveTo(0,-1.25,0,-1.25,0,0),t.bezierCurveTo(0,1.25,0,1.25,-5,2.5),t.fillStyle="#555",t.fill(),t.restore(),t.beginPath();const c=p*Math.sin(this.topFlapAngle),h=p*Math.sin(this.bottomFlapAngle);if(t.lineCap="round",t.lineJoin="round",t.moveTo(.2*i.ROCKET_HEIGHT,0),t.lineTo(.1*i.ROCKET_HEIGHT,c),t.lineTo(0,c),t.lineTo(0,0),t.closePath(),t.moveTo(-.2*i.ROCKET_HEIGHT,0),t.lineTo(-.3*i.ROCKET_HEIGHT,h),t.lineTo(-.4*i.ROCKET_HEIGHT,h),t.lineTo(-.4*i.ROCKET_HEIGHT,0),t.closePath(),t.fillStyle="#555",t.fill(),t.strokeStyle="#555",t.stroke(),t.restore(),this.prediction){t.beginPath(),this.mesh.at(new s.Vector(this.prediction.position.x,this.prediction.position.y),this.prediction.angle).path(t),t.strokeStyle="#f0f";const e=t.getTransform();t.setTransform(1,0,0,1,0,0),t.stroke(),t.setTransform(e)}if(n.debug){this.mesh.at(this.position,this.angle).draw(t),this.legs().map((e=>e.draw(t)));for(const e of this.legContacts)e&&r.ConvexPolygon.regular(3,1).at(e,0).draw(t);t.beginPath(),t.strokeStyle="#f00";for(const{a:e,b:o,impulse:i}of this.dragSides){t.moveTo(e.x,e.y),t.lineTo(o.x,o.y);const n=e.add(o).mul(.5);t.moveTo(n.x,n.y);const s=1e-5;t.lineTo(n.x+s*i.x,n.y+s*i.y)}const e=t.getTransform();t.setTransform(1,0,0,1,0,0),t.lineWidth=3,t.stroke(),t.lineWidth=1,t.setTransform(e)}}}e.Rocket=b,b.MESH=new r.ConvexPolygon([new s.Vector(.4*i.ROCKET_HEIGHT*.5,-.5*i.ROCKET_WIDTH),new s.Vector(.4*i.ROCKET_HEIGHT,0),new s.Vector(.4*i.ROCKET_HEIGHT*.5,.5*i.ROCKET_WIDTH),new s.Vector(-.6*i.ROCKET_HEIGHT*u,.5*i.ROCKET_WIDTH),new s.Vector(-.6*i.ROCKET_HEIGHT*.8,0),new s.Vector(-.6*i.ROCKET_HEIGHT*u,-.5*i.ROCKET_WIDTH)]),b.LEG_MESH=new r.ConvexPolygon([new s.Vector(10,0),new s.Vector(0,0)]),b.FLAP_MESH=new r.ConvexPolygon([new s.Vector(-.2*i.ROCKET_HEIGHT,0),new s.Vector(0,0)]),b.LEG_JOINTS=[{position:new s.Vector(-.6*i.ROCKET_HEIGHT*u,-.45*i.ROCKET_WIDTH),angle:-2.7},{position:new s.Vector(-.6*i.ROCKET_HEIGHT*u,.45*i.ROCKET_WIDTH),angle:2.7}],e.rocket=new b,e.default=e.rocket},593:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Satellite=void 0;const i=o(913),n=o(601),s=o(490),r=o(357),a=o(477),l=o(842),c=o(211),h=o(536);let u=0;class p extends r.PhysicsObject{constructor(t){super(p.MESH),this.transmissions=[],this.id=u++,this.inverseMass=2e-4*p.MESH.area(),this.inverseInertia=.01*this.inverseMass,this.nextTransmissionTime=c.time+.125*t}update(t){super.update(t),c.time>this.nextTransmissionTime&&(this.transmissions.push({origin:this.position,time:c.time,remove:!1,range:0,referencePoint:this.position}),this.nextTransmissionTime+=.125);for(const t of this.transmissions){const e=l.rocket.position.sub(t.origin),o=e.len();if(o<10)continue;const i=o<1?new s.Vector(1,0):e.mul(1/o),r=c.time-t.time;t.range=n.TRANSMISSION_SPEED*r;const u=t.origin.add(i.mul(t.range));if(t.referencePoint=u,e.len()<t.range){const o=t.time+e.len()/n.TRANSMISSION_SPEED;h.send({satellitePing:{id:this.id,origin:t.origin,sendTime:t.time,receiveTime:o}}),t.remove=!0}else u.sub(a.planet.position).len()<n.PLANET_RADIUS&&(t.remove=!0)}let e=0;for(let t=0,o=this.transmissions.length;t<o;t++)this.transmissions[t].remove||(this.transmissions[e++]=this.transmissions[t]);this.transmissions.length=e}draw(t){if(t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.angle),t.fillStyle="#bbb",t.fillRect(-.5,-2,1,4),t.fillRect(-3,-1,6,2),t.fillStyle="#00b",t.fillRect(-1.5,-10,3,8),t.fillRect(-1.5,2,3,8),i.debug&&(this.mesh.draw(t),t.beginPath(),t.moveTo(0,0),t.arc(0,0,100,0,2*Math.PI),t.strokeStyle="#f00",t.setTransform(1,0,0,1,0,0),t.stroke()),t.restore(),i.debug){t.save(),t.beginPath();for(const e of this.transmissions){t.moveTo(e.origin.x,e.origin.y);const o=e.referencePoint.sub(e.origin),i=Math.atan2(o.y,o.x);t.arc(e.origin.x,e.origin.y,e.range,i,2*Math.PI+i)}t.strokeStyle="#ff0",t.setTransform(1,0,0,1,0,0),t.stroke(),t.restore()}}}e.Satellite=p,p.MESH=new r.ConvexPolygon([new s.Vector(-1,-10),new s.Vector(1,-10),new s.Vector(3,0),new s.Vector(1,10),new s.Vector(-1,10),new s.Vector(-3,0)])},211:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.draw=e.update=e.addExplosion=e.addSmoke=e.add=e.time=void 0;const i=o(601),n=o(357),s=o(477);e.time=0;const r=[];e.add=function(t){r.push(t)};const a=[],l=[];e.addSmoke=function(t,o,i){const n=75+Math.floor(25*Math.random());a.push({position:t,velocity:o,birthTime:e.time,size:i,luminance:n})},e.addExplosion=function(t,o,i){const n=20+Math.floor(40*Math.random());l.push({position:t,velocity:o,birthTime:e.time,size:i,hue:n})},e.update=function(t){e.time+=t;{let t=0;const o=a.length;for(let i=0;i<o;i++)a[i].birthTime+.2>e.time&&(a[t++]=a[i]);a.length=t}{let t=0;const o=l.length;for(let i=0;i<o;i++)l[i].birthTime+3>e.time&&(l[t++]=l[i]);l.length=t}for(const e of[...a,...l]){const o=e.velocity.sub(s.planet.velocityAt(e.position)),n=e.position.len()-i.PLANET_RADIUS,r=Math.min(Math.max(1-n/i.ATMOSPHERE_SIZE,0),1);if(e.velocity=e.velocity.sub(o.mul(r*t)),e.position=e.position.add(e.velocity.mul(t)),e.position.len()<i.PLANET_RADIUS){const t=e.position.norm();e.position=t.mul(i.PLANET_RADIUS),e.velocity=e.velocity.sub(t.mul(t.dot(e.velocity)))}}for(const e of[...r,...a]){const o=s.planet.position.sub(e.position),n=o.len();e.velocity=e.velocity.add(o.mul(t*i.GRAVITY/Math.pow(n,3)))}s.planet.update(t);for(const e of r)e.update(t);const o=s.planet.worldMesh();for(const t of r){const e=t.worldMesh(),i=o.intersect(e);if(!i)continue;const{contact:r,distance:a,normal:l}=i;(0,n.collide)(s.planet,t,r,l,{restitution:.1,staticFriction:1,dynamicFriction:.5}),(0,n.separate)(s.planet,t,l,a)}},e.draw=function(t){s.planet.draw(t);for(const e of r)e.draw(t);for(let o=a.length-1;o>=0;o--){const i=a[o],n=Math.min((e.time-i.birthTime)/.2,1),s=i.size*(.1+.9*Math.pow(n,.5)),r=Math.pow(1-n,2),l=i.position,c=t.createRadialGradient(l.x,l.y,0,l.x,l.y,s);c.addColorStop(0,`hsla(0, 0%, ${i.luminance}%, 1)`),c.addColorStop(1,`hsla(0, 0%, ${i.luminance}%, 0)`),t.fillStyle=c,t.globalAlpha=r,t.fillRect(l.x-s,l.y-s,2*s,2*s)}for(let o=l.length-1;o>=0;o--){const i=l[o],n=Math.min((e.time-i.birthTime)/3,1),s=i.size*(.1+.9*Math.pow(n,.5)),r=Math.pow(1-n,2),a=i.position,c=t.createRadialGradient(a.x,a.y,0,a.x,a.y,s),h=Math.floor(100*(1-n));c.addColorStop(0,`hsla(${i.hue}, ${h}%, 50%, 1)`),c.addColorStop(1,`hsla(${i.hue}, ${h}%, 50%, 0)`),t.fillStyle=c,t.globalAlpha=r,t.fillRect(a.x-s,a.y-s,2*s,2*s)}t.globalAlpha=1}},536:(t,e,o)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.pollSensors=e.send=e.difficulty=void 0;const n=o(601),s=o(490),r=o(477),a=o(842),l=null!==(i=localStorage.path)&&void 0!==i?i:"http://localhost:8000/solution.js",c=new URL("user-main.js",location.href).toString(),h=new Worker(URL.createObjectURL(new Blob([`importScripts("${encodeURI(c)}", "${encodeURI(l)}")`])));let u=!1,p=!1;function d(t){void 0!==e.difficulty&&(a.rocket.exploded||h.postMessage(t))}h.addEventListener("message",(t=>{const o=t.data;if(null===o||"object"!=typeof o)return void console.warn("Ignoring bad message: not an object");const i=o;if(i.configuration){if(u)return void console.error("Configuration cannot be changed once it is set.");try{!function(t){if("object"!=typeof t)throw new m("not an object");(function(t){if(f(t,"difficulty"),"easy"!==t.difficulty&&"medium"!==t.difficulty&&"hard"!==t.difficulty)throw new m('difficulty selection must "easy", "medium", or "hard"')})(t),g(t,"fuel",0,1),g(t,"rcsFuel",0,1)}(i.configuration),e.difficulty=i.configuration.difficulty,a.rocket.fuel=n.FUEL*i.configuration.fuel,a.rocket.rcsFuel=n.RCS_FUEL*i.configuration.rcsFuel,u=!0}catch(t){console.log(t.message)}}if(!u&&!p)return console.warn("Ignoring messages before configuration is set."),void(p=!0);if(void 0!==i.intent)try{!function(t){if("object"!=typeof t)throw new m("not an object");(function(t,e){if(f(t,e),"boolean"!=typeof t[e])throw new m(`${e} is not a boolean`)})(t,"landingGearDown"),g(t,"thrusterAngle",-n.MAX_ROCKET_THRUSTER_ANGLE,n.MAX_ROCKET_THRUSTER_ANGLE),g(t,"thrust",0,1),g(t,"topFlapAngle",-1,1),g(t,"bottomFlapAngle",-1,1),function(t){f(t,"rcsThrust");const e=t.rcsThrust;if(null===e||"object"!=typeof e)throw new m("rcsThrust is not an object");g(e,"topLeft",0,1),g(e,"topRight",0,1),g(e,"bottomLeft",0,1),g(e,"bottomRight",0,1)}(t)}(i.intent),a.rocket.intent=i.intent}catch(t){console.error(t.message)}if(void 0!==i.prediction)try{!function(t){if("object"!=typeof t)throw new m("not an object");(function(t,e){f(t,e);const o=t[e];if("object"!=typeof o)throw new m("position is not a vector");f(o,"x"),f(o,"y")})(t,"position"),g(t,"angle",-Math.PI,Math.PI)}(i.prediction),a.rocket.prediction=i.prediction}catch(t){console.error(t.message)}})),e.send=d,e.pollSensors=function(t){if(void 0===e.difficulty)return;const o=r.default.position.sub(a.rocket.position),i=o.len(),l=o.mul(n.GRAVITY/Math.pow(i,3)),c=s.Matrix.rotate(-a.rocket.angle).apply(a.rocket.acceleration.sub(l)),h={sensors:{gyro:a.rocket.angle,acceleration:c,landingGear:a.rocket.landingGear,thruster:{angle:a.rocket.thrusterAngle,thrust:a.rocket.thrust},topFlapAngle:a.rocket.topFlapAngle,bottomFlapAngle:a.rocket.bottomFlapAngle,fuel:a.rocket.fuel/n.FUEL,rcsFuel:a.rocket.rcsFuel/n.RCS_FUEL}};"easy"==e.difficulty&&(h.location={position:a.rocket.position,velocity:a.rocket.velocity,angle:a.rocket.angle,angularVelocity:a.rocket.angularVelocity}),d(h)};class m extends Error{constructor(t){super(`Bad intent: ${t}`)}}function f(t,e){if(!(e in t))throw new m(`${e} is not set`)}function g(t,e,o,i){f(t,e);const n=t[e];if("number"!=typeof n||isNaN(n)||n<o||i<n)throw new m(`${e} should be a number in the range [${o}, ${i}]`)}}},e={};function o(i){var n=e[i];if(void 0!==n)return n.exports;var s=e[i]={exports:{}};return t[i](s,s.exports,o),s.exports}(()=>{const t=o(913),e=o(601),i=o(279),n=o(490),s=o(477),r=o(374),a=o(842),l=o(593),c=o(211),h=o(536);c.add(a.rocket),a.rocket.position.x=e.PLANET_RADIUS+.6*e.ROCKET_HEIGHT,a.rocket.velocity=s.planet.velocityAt(a.rocket.position);for(let t=0;t<16;t++){const o=e.PLANET_RADIUS+5*e.ATMOSPHERE_SIZE,i=n.Vector.fromAngle(t/16*2*Math.PI),s=new l.Satellite(1-t/16);s.position=i.mul(o),s.velocity=i.rot90().mul(-Math.sqrt(e.GRAVITY/o)),s.angle=Math.random(),c.add(s)}const u=[];let p=0,d=0;setInterval((()=>{for(let o=0;o<t.simulationSpeed;o++){if(c.update(e.DELTA_TIME),c.time>=p){if(2048==u.length){let t=0;for(let e=16;e<2048;e+=2)u[t++]=u[e];u.splice(t)}const t={time:c.time,position:a.rocket.position,planetPosition:s.planet.toLocal(a.rocket.position)};a.rocket.prediction&&(t.predictedPosition=new n.Vector(a.rocket.prediction.position.x,a.rocket.prediction.position.y)),u.push(t),p+=.0625}c.time>=d&&(h.pollSensors(e.SENSOR_TIME),d+=e.SENSOR_TIME),h.send({tick:{simulationSpeed:t.simulationSpeed,time:c.time,planetAngle:s.planet.angle}})}i.camera.position=a.rocket.position;const o=a.rocket.position.sub(s.planet.position);i.camera.angle=Math.atan2(o.y,o.x)+Math.PI/2,r.check()}),1e3*e.DELTA_TIME),function t(){(0,i.draw)((t=>{c.draw(t);const o=t.getTransform();t.beginPath();for(const{position:e}of u)t.lineTo(e.x,e.y);t.setTransform(1,0,0,1,0,0),t.strokeStyle="#0f0",t.stroke(),t.setTransform(o),t.beginPath();for(const{planetPosition:e}of u){const o=s.planet.toWorld(e);t.lineTo(o.x,o.y)}t.setTransform(1,0,0,1,0,0),t.strokeStyle="#00f",t.stroke(),t.setTransform(o),t.beginPath();for(const{predictedPosition:e}of u)void 0!==e&&t.lineTo(e.x,e.y);t.setTransform(1,0,0,1,0,0),t.strokeStyle="#f0f",t.stroke(),t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(.5*t.canvas.width-125,0,250,50),t.fillStyle="#fff",t.textBaseline="top";const i=a.rocket.position.len()>e.PLANET_RADIUS+e.ATMOSPHERE_SIZE,n=i?a.rocket.velocity:a.rocket.velocity.sub(s.planet.velocityAt(a.rocket.position));t.textAlign="right",t.fillText(`${n.len().toFixed(0)}m/s`,.5*t.canvas.width-10,10),t.textAlign="left",t.fillText(i?"orbit":"surface",.5*t.canvas.width+10,10),r.drawStatus(t)})),requestAnimationFrame(t)}()})()})();
